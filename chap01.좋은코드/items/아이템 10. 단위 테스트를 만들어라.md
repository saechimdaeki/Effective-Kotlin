# 아이템 10. 단위 테스트를 만들어라

코드를 안전하게 만드는 궁극적인 방법은 다양한 종류의 테스트를 하는것이다. 이러한 종류의 테스트는 개발자의 관점에서 애플리케이션 내부적으로 올바르게 작동하는지 

확인하는 것이 아니라, 사용자의 관점에서 애플리케이션 외부적으로 제대로 작동하는지 확인하는 것이 목표이다. 일반적으로 대부분의 관리자는

이러한 테스트만 인지하고 있지만 이러한 테스트는 개발자에게 유용하지만 충분하지는 않다. 이것만으로는 해당 요소가 올바르게 작동한다는 것을

완전하게 보증할 수는 없다. 또한 개발 시점에서 빠른 피드백을 받을 수 없다. 

이러한 문제를 햐결하려면 `단위 테스트(unit test)`가 필요하다. 단위 테스트는 개발자가 작성하며, 개발자에게 유용하다.

다음 예는 피보나치 수를 계산하는 피보나치 숫자 5개를 제대로 구하는지 확인하는 테스트이다.

```kotlin
@Test
fun `fib works correctly for the first 5 positions`() {
    assertEquals(1, fib(0))
    assertEquals(1, fib(1))
    assertEquals(2, fib(2))
    assertEquals(3, fib(3))
    assertEquals(5, fib(4))
}
```

단위 테스트는 일반적으로 다음과 같은 내용을 확인한다.

- 일반적인 유스케이스: 요소가 사용될 거라고 예상되는 일반적인 방법을 테스트한다. 예를 들어 앞의 코드처럼 함수로 간단한 숫자 몇개를 테스트한다
- 일반적인 오류 케이스와 잠재적인 문제: 제대로 동작하지 않을 거라고 예상되는 일반적인 부분, 과거에 문제가 발생했던 부분등을 테스트한다
- 에지 케이스와 잘못된 아규먼트: Int의 경우 Int.MAX_VALUE를 사용하는 경우, nullable의 경우 null 또는 null 값으로 채워진 객체

    를 사용하는 경우를 의미한다. 또한 피보나치 수는 양의 정수로만 구할 수 있다. 음의 정수 등을 넣으면 아규먼트 자체가 잘못된 것이다. 이러한 경우를 테스트할수있다

단위 테스트는 개발자가 만들고 있는 요소가 제대로 동작하는지를 빠르게 피드백해 주므로 개발하는 동안에 큰 도움이 된다. 테스트는 계속해서 축적되므로 회귀테스트도 쉽다.

또한 수동으로 테스트하기 어려운 것들도 확인할 수 있다. TDD라는 접근 방식도 있다. 

단위 테스트의 장점을 정리해 보면 다음과 같다
- 테스트가 잘 된 요소는 신뢰할 수 있다. 요소를 신뢰할 수 있으므로 요소를 활용한 작업에 자신감이 생긴다
- 테스트가 잘 만들어져 있다면, 리팩터링하는것이 두렵지 않다. 테스트가 있으므로 리팩터링했을 때 버그가 생기는지 쉽게 확인할 수 있다.
- 수동으로 테스트하는 것보다 단위 테스트로 확인하는것이 빠르다. 빠른 속도의 피드백루프가 만들어지므로 개발의 전체적 속도가 빨라진다

하지만 다음과 같은 단점도 있다
- 단위 테스트를 만드는 데 시간이 걸린다. 다만 장기적으로 좋은 테스트는 `디버깅 시간` 과 `버그를 찾는데 소모되는 시간`을 줄여준다 
- 테스트를 활용할 수 있게 코드를 조정해야 한다. 변경하기 어렵기는 하지만 이러한 변경을 통해 잘 정립된 아키텍처를 사용하는 것이 강제된다
- 좋은 단위 테스트를 만드는 작업이 꽤 어렵다. 남은 개발 과정에 대한 확실한 이해가 필요하다. 잘못 만들어진 단위 테스트는 득보다 실이 크다.

효과적인 단위 테스트를 하는 방법을 습득하고, 단위 테스트를 위한 코드를 작성하는 것이 생각보다 어렵다. 숙련된 개발자가 되려면 단위 테스트와 관련된 기술을 습득하고,

중요한 코드라고 할 수 있는 다음과 같은 부분에 대해 단위 테스트하는 방법을 알고 있어야 한다
- 복잡한 부분
- 계속해서 수정이 일어나고 리팩터링이 일어날 수 있는 부분
- 비즈니스 로직 부분
- 공용 API 부분
- 문제가 자주 발생하는 부분
- 수정해야 하는 프로덕션 버그

# 아이템 10 - 정리

이번 장에서 설명한 내용들을 활용하면, 안정적인 프로그램을 만들 수있다. 하지만 가장 중요한 것은 애플리케이션이 진짜로 올바르게 동작하는지

확인하는 것이다. 이것이 테스트이다. 테스트 중에서 개발 과정에서 가장 효율적으로 활용할 수 있는 테스트는 바로 단위 테스트이다.

비즈니스 애플리케이션 등에서는 최소한 몇 개라도 단위 테스트가 꼭 필요하다.